/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package quotes;

import com.google.gson.*;
import com.google.gson.stream.JsonReader;

import java.io.*;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.*;

public class App {

    public static void main(String[] args) {
        String allQuotesAsString = readFile();
        Quote[] allQuotes = storeQuotes(allQuotesAsString);
        int randomNumber = generateRandomNumber(allQuotes);
        printAuthorAndQuote(allQuotes, randomNumber);
        apiCall();
//        addtoJsonArr();

    }

    public static void apiCall(){
//  Connection to API
        try {
            URL url =  url = new URL("http://swquotesapi.digitaljedi.dk/api/SWQuote/RandomStarWarsQuote");
            HttpURLConnection connection = (HttpURLConnection) url.openConnection();
            connection.setRequestMethod("GET");
            System.out.println(connection.getResponseCode());

//  Reads in the request response
            JsonReader reader = new JsonReader(new InputStreamReader(connection.getInputStream()));
            JsonParser parser = new JsonParser();
            JsonElement rootElement = parser.parse(reader);
            JsonObject apiQuoteJson = rootElement.getAsJsonObject();

            Gson gson = new Gson();
            Quote apiQuote = gson.fromJson(apiQuoteJson, Quote.class);
//            System.out.println(apiQuote.starWarsQuote);
            gson.toJson(apiQuote.starWarsQuote);

            apiQuoteJson.add("text", apiQuoteJson.get("starWarsQuote"));
            System.out.println(gson.toJson(apiQuote.starWarsQuote));

            JsonArray jsonArray = new JsonArray();

            jsonArray = gson.fromJson(new FileReader("./src/main/resources/recentquotes.json"), JsonArray.class);

            jsonArray.add(gson.toJson(apiQuote.starWarsQuote));
            FileWriter writeToFile = new FileWriter("src/main/resources/test.JSON");
            gson.toJson(jsonArray, writeToFile);
            writeToFile.close();




        } catch (IOException e) {
            e.printStackTrace();
        }
    }

//  Create method to add to jsonfile
//    public void addtoJsonFile(String content){
//        JsonArray jsonArrQuote = new JsonArray();
//    }

// create method to add to jsonArray
//    public static JsonArray addtoJsonArr(String apiQuoteJson){
//        JsonArray jsonArray = new JsonArray();
//        apiQuoteJson.addProperty("text", apiQuote.starWarsQuote);
//
//        jsonArray.add(apiQuoteJson);
//        FileWriter writeToFile = new FileWriter("src/main/resources/test.JSON");
//        gson.toJson(apiQuoteJson, writeToFile);
//        writeToFile.close();
//
//        return jsonArray;
//    }


    public static String readFile(){
        try{
//      Reads in Json File
        Scanner reader = new Scanner(new File("src/main/resources/recentquotes.JSON"));
        StringBuilder sb = new StringBuilder();
//      Ensures all quotes are printed
            while(reader.hasNextLine()){
                sb.append(reader.nextLine());
            }
            return sb.toString();
        } catch (IOException e){
            e.printStackTrace();
            return "";
        }
    }

    public static Quote[] storeQuotes(String quotes){
//      Stores our quotes & Authors
        return new Gson().fromJson(quotes, Quote[].class);
    }

    public static int generateRandomNumber(Quote[] allQuotes){
        Random randomNumber = new Random();
        int n = randomNumber.nextInt(allQuotes.length);
        return n;
    }

    private static void printAuthorAndQuote(Quote[] allQuotes, int n){
        System.out.println(allQuotes[n]);
    }

}
